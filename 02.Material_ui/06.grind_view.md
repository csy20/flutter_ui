# Flutter GridView Widget: Complete Guide

## What is GridView?

`GridView` is a powerful scrollable widget in Flutter that displays items in a 2D grid layout. It's the grid equivalent of ListView, allowing you to arrange widgets in rows and columns efficiently. GridView is essential in Material Design apps for displaying collections of data in a visually organized, grid-based format.

### Key Characteristics:

- **2D Layout**: Arranges items in both rows and columns
- **Scrollable**: Automatically provides scrolling when content exceeds viewport
- **Performance Optimized**: Only builds visible items (lazy loading)
- **Flexible**: Multiple constructors for different use cases
- **Material Design Compatible**: Perfect for photo galleries, product catalogs, dashboards
- **Responsive**: Adapts to different screen sizes and orientations

## Why GridView is Important in Material Apps

### 1. **Visual Organization**
- **Efficient Space Usage**: Makes better use of screen real estate
- **Visual Appeal**: Creates organized, grid-based layouts
- **Consistency**: Maintains uniform item sizes and spacing

### 2. **Common Use Cases**
- Photo galleries and media libraries
- Product catalogs and shopping apps
- Dashboard widgets and analytics
- Icon grids and app launchers
- Contact lists with avatars
- File browsers and document viewers

### 3. **Material Design Benefits**
- **Card Layouts**: Perfect for Material cards in grid format
- **Responsive Design**: Adapts to different screen sizes
- **Touch Interactions**: Built-in Material ripple effects

## GridView Constructors

### 1. **GridView.count() - Fixed Column Count**

Creates a grid with a fixed number of columns.

```dart
GridView.count(
  crossAxisCount: 2,  // Number of columns
  padding: EdgeInsets.all(16),
  crossAxisSpacing: 16,  // Horizontal spacing
  mainAxisSpacing: 16,   // Vertical spacing
  children: [
    Container(
      decoration: BoxDecoration(
        color: Colors.blue,
        borderRadius: BorderRadius.circular(8),
      ),
      child: Center(child: Text('Item 1')),
    ),
    Container(
      decoration: BoxDecoration(
        color: Colors.green,
        borderRadius: BorderRadius.circular(8),
      ),
      child: Center(child: Text('Item 2')),
    ),
    Container(
      decoration: BoxDecoration(
        color: Colors.red,
        borderRadius: BorderRadius.circular(8),
      ),
      child: Center(child: Text('Item 3')),
    ),
    Container(
      decoration: BoxDecoration(
        color: Colors.orange,
        borderRadius: BorderRadius.circular(8),
      ),
      child: Center(child: Text('Item 4')),
    ),
  ],
)
```

**Best for**: Fixed grids with known column count

### 2. **GridView.extent() - Fixed Item Width**

Creates a grid where each item has a maximum cross-axis extent (width).

```dart
GridView.extent(
  maxCrossAxisExtent: 150,  // Maximum width per item
  padding: EdgeInsets.all(16),
  crossAxisSpacing: 16,
  mainAxisSpacing: 16,
  children: [
    for (int i = 0; i < 20; i++)
      Card(
        elevation: 2,
        child: Center(
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              Icon(Icons.star, size: 32, color: Colors.amber),
              SizedBox(height: 8),
              Text('Item ${i + 1}'),
            ],
          ),
        ),
      ),
  ],
)
```

**Best for**: Responsive grids that adapt to screen width

### 3. **GridView.builder() - Performance Optimized**

Creates a grid with lazy loading for better performance with large datasets.

```dart
GridView.builder(
  gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
    crossAxisCount: 2,
    crossAxisSpacing: 16,
    mainAxisSpacing: 16,
    childAspectRatio: 1.0,  // Width/Height ratio
  ),
  padding: EdgeInsets.all(16),
  itemCount: 1000,  // Total number of items
  itemBuilder: (BuildContext context, int index) {
    return Card(
      elevation: 2,
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          CircleAvatar(
            radius: 30,
            backgroundColor: Colors.blue,
            child: Text('${index + 1}'),
          ),
          SizedBox(height: 8),
          Text(
            'Item ${index + 1}',
            style: TextStyle(fontWeight: FontWeight.bold),
          ),
          Text('Description'),
        ],
      ),
    );
  },
)
```

**Best for**: Large datasets, dynamic content, performance-critical scenarios

### 4. **GridView.custom() - Advanced Customization**

Creates a grid with custom sliver child delegate for advanced scenarios.

```dart
GridView.custom(
  gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
    crossAxisCount: 3,
    crossAxisSpacing: 8,
    mainAxisSpacing: 8,
  ),
  childrenDelegate: SliverChildBuilderDelegate(
    (context, index) {
      return Container(
        decoration: BoxDecoration(
          gradient: LinearGradient(
            colors: [Colors.purple, Colors.blue],
            begin: Alignment.topLeft,
            end: Alignment.bottomRight,
          ),
          borderRadius: BorderRadius.circular(12),
        ),
        child: Center(
          child: Text(
            '${index + 1}',
            style: TextStyle(
              color: Colors.white,
              fontSize: 24,
              fontWeight: FontWeight.bold,
            ),
          ),
        ),
      );
    },
    childCount: 50,
  ),
)
```

**Best for**: Complex custom layouts and specialized use cases

## Grid Delegates

Grid delegates control how items are laid out in the grid.

### 1. **SliverGridDelegateWithFixedCrossAxisCount**

```dart
SliverGridDelegateWithFixedCrossAxisCount(
  crossAxisCount: 2,           // Number of columns
  crossAxisSpacing: 16.0,      // Horizontal spacing
  mainAxisSpacing: 16.0,       // Vertical spacing
  childAspectRatio: 1.0,       // Width/Height ratio (1.0 = square)
)

// Different aspect ratios
SliverGridDelegateWithFixedCrossAxisCount(
  crossAxisCount: 2,
  childAspectRatio: 0.75,      // Taller items (3:4 ratio)
)

SliverGridDelegateWithFixedCrossAxisCount(
  crossAxisCount: 3,
  childAspectRatio: 1.5,       // Wider items (3:2 ratio)
)
```

### 2. **SliverGridDelegateWithMaxCrossAxisExtent**

```dart
SliverGridDelegateWithMaxCrossAxisExtent(
  maxCrossAxisExtent: 200.0,   // Maximum width per item
  crossAxisSpacing: 16.0,
  mainAxisSpacing: 16.0,
  childAspectRatio: 1.0,
)

// Responsive design example
SliverGridDelegateWithMaxCrossAxisExtent(
  maxCrossAxisExtent: MediaQuery.of(context).size.width > 600 ? 200 : 150,
  crossAxisSpacing: 16.0,
  mainAxisSpacing: 16.0,
  childAspectRatio: 1.0,
)
```

## Material GridView Patterns

### 1. **Photo Gallery Grid**

```dart
class PhotoGalleryGrid extends StatelessWidget {
  final List<Photo> photos;

  const PhotoGalleryGrid({required this.photos});

  @override
  Widget build(BuildContext context) {
    return GridView.builder(
      padding: EdgeInsets.all(8),
      gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
        crossAxisCount: MediaQuery.of(context).size.width > 600 ? 4 : 2,
        crossAxisSpacing: 8,
        mainAxisSpacing: 8,
        childAspectRatio: 1.0,
      ),
      itemCount: photos.length,
      itemBuilder: (context, index) {
        final photo = photos[index];
        return GestureDetector(
          onTap: () => _openPhoto(context, photo),
          child: Card(
            elevation: 2,
            clipBehavior: Clip.antiAlias,
            child: Stack(
              fit: StackFit.expand,
              children: [
                Image.network(
                  photo.thumbnailUrl,
                  fit: BoxFit.cover,
                  loadingBuilder: (context, child, loadingProgress) {
                    if (loadingProgress == null) return child;
                    return Center(
                      child: CircularProgressIndicator(
                        value: loadingProgress.expectedTotalBytes != null
                          ? loadingProgress.cumulativeBytesLoaded / 
                            loadingProgress.expectedTotalBytes!
                          : null,
                      ),
                    );
                  },
                  errorBuilder: (context, error, stackTrace) {
                    return Container(
                      color: Colors.grey[300],
                      child: Icon(Icons.error, color: Colors.grey[600]),
                    );
                  },
                ),
                
                // Overlay with photo info
                Positioned(
                  bottom: 0,
                  left: 0,
                  right: 0,
                  child: Container(
                    decoration: BoxDecoration(
                      gradient: LinearGradient(
                        begin: Alignment.topCenter,
                        end: Alignment.bottomCenter,
                        colors: [Colors.transparent, Colors.black54],
                      ),
                    ),
                    padding: EdgeInsets.all(8),
                    child: Text(
                      photo.title,
                      style: TextStyle(
                        color: Colors.white,
                        fontWeight: FontWeight.bold,
                      ),
                      maxLines: 1,
                      overflow: TextOverflow.ellipsis,
                    ),
                  ),
                ),
                
                // Selection indicator
                if (photo.isSelected)
                  Positioned(
                    top: 8,
                    right: 8,
                    child: Container(
                      decoration: BoxDecoration(
                        color: Theme.of(context).primaryColor,
                        shape: BoxShape.circle,
                      ),
                      padding: EdgeInsets.all(4),
                      child: Icon(
                        Icons.check,
                        color: Colors.white,
                        size: 16,
                      ),
                    ),
                  ),
              ],
            ),
          ),
        );
      },
    );
  }

  void _openPhoto(BuildContext context, Photo photo) {
    Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => PhotoDetailScreen(photo: photo),
      ),
    );
  }
}
```

### 2. **Product Catalog Grid**

```dart
class ProductCatalogGrid extends StatelessWidget {
  final List<Product> products;

  const ProductCatalogGrid({required this.products});

  @override
  Widget build(BuildContext context) {
    return GridView.builder(
      padding: EdgeInsets.all(16),
      gridDelegate: SliverGridDelegateWithMaxCrossAxisExtent(
        maxCrossAxisExtent: 200,
        crossAxisSpacing: 16,
        mainAxisSpacing: 16,
        childAspectRatio: 0.7,  // Taller cards for product info
      ),
      itemCount: products.length,
      itemBuilder: (context, index) {
        final product = products[index];
        return Card(
          elevation: 4,
          clipBehavior: Clip.antiAlias,
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              // Product image
              Expanded(
                flex: 3,
                child: Stack(
                  children: [
                    Image.network(
                      product.imageUrl,
                      width: double.infinity,
                      fit: BoxFit.cover,
                    ),
                    
                    // Discount badge
                    if (product.discountPercentage > 0)
                      Positioned(
                        top: 8,
                        left: 8,
                        child: Container(
                          padding: EdgeInsets.symmetric(
                            horizontal: 8,
                            vertical: 4,
                          ),
                          decoration: BoxDecoration(
                            color: Colors.red,
                            borderRadius: BorderRadius.circular(12),
                          ),
                          child: Text(
                            '-${product.discountPercentage}%',
                            style: TextStyle(
                              color: Colors.white,
                              fontSize: 12,
                              fontWeight: FontWeight.bold,
                            ),
                          ),
                        ),
                      ),
                    
                    // Favorite button
                    Positioned(
                      top: 8,
                      right: 8,
                      child: Container(
                        decoration: BoxDecoration(
                          color: Colors.white.withOpacity(0.8),
                          shape: BoxShape.circle,
                        ),
                        child: IconButton(
                          icon: Icon(
                            product.isFavorite 
                              ? Icons.favorite 
                              : Icons.favorite_border,
                            color: product.isFavorite 
                              ? Colors.red 
                              : Colors.grey,
                          ),
                          onPressed: () => _toggleFavorite(product),
                        ),
                      ),
                    ),
                  ],
                ),
              ),
              
              // Product info
              Expanded(
                flex: 2,
                child: Padding(
                  padding: EdgeInsets.all(12),
                  child: Column(
                    crossAxisAlignment: CrossAxisAlignment.start,
                    children: [
                      Text(
                        product.name,
                        style: TextStyle(
                          fontWeight: FontWeight.bold,
                          fontSize: 14,
                        ),
                        maxLines: 2,
                        overflow: TextOverflow.ellipsis,
                      ),
                      
                      SizedBox(height: 4),
                      
                      Row(
                        children: [
                          Icon(Icons.star, color: Colors.amber, size: 16),
                          SizedBox(width: 4),
                          Text(
                            '${product.rating}',
                            style: TextStyle(fontSize: 12),
                          ),
                          Text(
                            ' (${product.reviewCount})',
                            style: TextStyle(
                              fontSize: 12,
                              color: Colors.grey,
                            ),
                          ),
                        ],
                      ),
                      
                      Spacer(),
                      
                      Row(
                        children: [
                          if (product.originalPrice != product.currentPrice)
                            Text(
                              '\$${product.originalPrice}',
                              style: TextStyle(
                                decoration: TextDecoration.lineThrough,
                                color: Colors.grey,
                                fontSize: 12,
                              ),
                            ),
                          if (product.originalPrice != product.currentPrice)
                            SizedBox(width: 4),
                          Text(
                            '\$${product.currentPrice}',
                            style: TextStyle(
                              fontWeight: FontWeight.bold,
                              color: Theme.of(context).primaryColor,
                            ),
                          ),
                        ],
                      ),
                    ],
                  ),
                ),
              ),
            ],
          ),
        );
      },
    );
  }

  void _toggleFavorite(Product product) {
    // Handle favorite toggle
  }
}
```

### 3. **Dashboard Widget Grid**

```dart
class DashboardGrid extends StatelessWidget {
  final List<DashboardWidget> widgets;

  const DashboardGrid({required this.widgets});

  @override
  Widget build(BuildContext context) {
    return GridView.builder(
      padding: EdgeInsets.all(16),
      gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
        crossAxisCount: MediaQuery.of(context).size.width > 600 ? 3 : 2,
        crossAxisSpacing: 16,
        mainAxisSpacing: 16,
        childAspectRatio: 1.2,
      ),
      itemCount: widgets.length,
      itemBuilder: (context, index) {
        final widget = widgets[index];
        return Card(
          elevation: 3,
          child: InkWell(
            onTap: () => _openWidget(context, widget),
            borderRadius: BorderRadius.circular(4),
            child: Padding(
              padding: EdgeInsets.all(16),
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  Container(
                    padding: EdgeInsets.all(12),
                    decoration: BoxDecoration(
                      color: widget.color.withOpacity(0.1),
                      shape: BoxShape.circle,
                    ),
                    child: Icon(
                      widget.icon,
                      size: 32,
                      color: widget.color,
                    ),
                  ),
                  
                  SizedBox(height: 12),
                  
                  Text(
                    widget.title,
                    style: TextStyle(
                      fontWeight: FontWeight.bold,
                      fontSize: 16,
                    ),
                    textAlign: TextAlign.center,
                  ),
                  
                  SizedBox(height: 4),
                  
                  Text(
                    widget.value,
                    style: TextStyle(
                      fontSize: 24,
                      fontWeight: FontWeight.bold,
                      color: widget.color,
                    ),
                  ),
                  
                  if (widget.subtitle.isNotEmpty) ...[
                    SizedBox(height: 4),
                    Text(
                      widget.subtitle,
                      style: TextStyle(
                        fontSize: 12,
                        color: Colors.grey[600],
                      ),
                      textAlign: TextAlign.center,
                    ),
                  ],
                ],
              ),
            ),
          ),
        );
      },
    );
  }

  void _openWidget(BuildContext context, DashboardWidget widget) {
    // Handle widget tap
  }
}
```

### 4. **Contact Grid with Avatars**

```dart
class ContactGrid extends StatelessWidget {
  final List<Contact> contacts;

  const ContactGrid({required this.contacts});

  @override
  Widget build(BuildContext context) {
    return GridView.builder(
      padding: EdgeInsets.all(16),
      gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
        crossAxisCount: MediaQuery.of(context).size.width > 600 ? 5 : 3,
        crossAxisSpacing: 16,
        mainAxisSpacing: 16,
        childAspectRatio: 0.8,
      ),
      itemCount: contacts.length,
      itemBuilder: (context, index) {
        final contact = contacts[index];
        return GestureDetector(
          onTap: () => _openContact(context, contact),
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              Stack(
                children: [
                  CircleAvatar(
                    radius: 40,
                    backgroundImage: contact.avatarUrl.isNotEmpty
                      ? NetworkImage(contact.avatarUrl)
                      : null,
                    backgroundColor: _getAvatarColor(contact.name),
                    child: contact.avatarUrl.isEmpty
                      ? Text(
                          contact.initials,
                          style: TextStyle(
                            fontSize: 24,
                            fontWeight: FontWeight.bold,
                            color: Colors.white,
                          ),
                        )
                      : null,
                  ),
                  
                  // Online status indicator
                  if (contact.isOnline)
                    Positioned(
                      bottom: 2,
                      right: 2,
                      child: Container(
                        width: 16,
                        height: 16,
                        decoration: BoxDecoration(
                          color: Colors.green,
                          shape: BoxShape.circle,
                          border: Border.all(
                            color: Colors.white,
                            width: 2,
                          ),
                        ),
                      ),
                    ),
                ],
              ),
              
              SizedBox(height: 8),
              
              Text(
                contact.firstName,
                style: TextStyle(
                  fontWeight: FontWeight.bold,
                  fontSize: 14,
                ),
                textAlign: TextAlign.center,
                maxLines: 1,
                overflow: TextOverflow.ellipsis,
              ),
              
              if (contact.lastName.isNotEmpty)
                Text(
                  contact.lastName,
                  style: TextStyle(
                    fontSize: 12,
                    color: Colors.grey[600],
                  ),
                  textAlign: TextAlign.center,
                  maxLines: 1,
                  overflow: TextOverflow.ellipsis,
                ),
            ],
          ),
        );
      },
    );
  }

  Color _getAvatarColor(String name) {
    final colors = [
      Colors.red, Colors.blue, Colors.green, Colors.orange,
      Colors.purple, Colors.teal, Colors.indigo, Colors.brown,
    ];
    final index = name.hashCode % colors.length;
    return colors[index.abs()];
  }

  void _openContact(BuildContext context, Contact contact) {
    // Handle contact tap
  }
}
```

### 5. **File Browser Grid**

```dart
class FileBrowserGrid extends StatelessWidget {
  final List<FileItem> files;

  const FileBrowserGrid({required this.files});

  @override
  Widget build(BuildContext context) {
    return GridView.builder(
      padding: EdgeInsets.all(16),
      gridDelegate: SliverGridDelegateWithMaxCrossAxisExtent(
        maxCrossAxisExtent: 120,
        crossAxisSpacing: 16,
        mainAxisSpacing: 16,
        childAspectRatio: 0.75,
      ),
      itemCount: files.length,
      itemBuilder: (context, index) {
        final file = files[index];
        return GestureDetector(
          onTap: () => _openFile(context, file),
          onLongPress: () => _showFileOptions(context, file),
          child: Column(
            children: [
              Expanded(
                child: Container(
                  width: double.infinity,
                  decoration: BoxDecoration(
                    color: Colors.grey[100],
                    borderRadius: BorderRadius.circular(8),
                    border: Border.all(color: Colors.grey[300]!),
                  ),
                  child: ClipRRect(
                    borderRadius: BorderRadius.circular(8),
                    child: _buildFilePreview(file),
                  ),
                ),
              ),
              
              SizedBox(height: 8),
              
              Text(
                file.name,
                style: TextStyle(
                  fontSize: 12,
                  fontWeight: FontWeight.w500,
                ),
                textAlign: TextAlign.center,
                maxLines: 2,
                overflow: TextOverflow.ellipsis,
              ),
              
              Text(
                _formatFileSize(file.size),
                style: TextStyle(
                  fontSize: 10,
                  color: Colors.grey[600],
                ),
              ),
            ],
          ),
        );
      },
    );
  }

  Widget _buildFilePreview(FileItem file) {
    if (file.isImage) {
      return Image.network(
        file.thumbnailUrl ?? file.url,
        fit: BoxFit.cover,
        errorBuilder: (context, error, stackTrace) {
          return _getFileIcon(file.extension);
        },
      );
    } else {
      return _getFileIcon(file.extension);
    }
  }

  Widget _getFileIcon(String extension) {
    IconData iconData;
    Color color;

    switch (extension.toLowerCase()) {
      case 'pdf':
        iconData = Icons.picture_as_pdf;
        color = Colors.red;
        break;
      case 'doc':
      case 'docx':
        iconData = Icons.description;
        color = Colors.blue;
        break;
      case 'xls':
      case 'xlsx':
        iconData = Icons.table_chart;
        color = Colors.green;
        break;
      case 'mp4':
      case 'avi':
      case 'mov':
        iconData = Icons.video_file;
        color = Colors.purple;
        break;
      case 'mp3':
      case 'wav':
        iconData = Icons.audio_file;
        color = Colors.orange;
        break;
      default:
        iconData = Icons.insert_drive_file;
        color = Colors.grey;
    }

    return Center(
      child: Icon(iconData, size: 48, color: color),
    );
  }

  String _formatFileSize(int bytes) {
    if (bytes < 1024) return '$bytes B';
    if (bytes < 1024 * 1024) return '${(bytes / 1024).toStringAsFixed(1)} KB';
    return '${(bytes / (1024 * 1024)).toStringAsFixed(1)} MB';
  }

  void _openFile(BuildContext context, FileItem file) {
    // Handle file open
  }

  void _showFileOptions(BuildContext context, FileItem file) {
    // Show context menu
  }
}
```

## Advanced GridView Patterns

### 1. **Staggered Grid Layout**

```dart
class StaggeredGridExample extends StatelessWidget {
  final List<StaggeredItem> items;

  const StaggeredGridExample({required this.items});

  @override
  Widget build(BuildContext context) {
    return CustomScrollView(
      slivers: [
        SliverGrid(
          gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
            crossAxisCount: 2,
            crossAxisSpacing: 8,
            mainAxisSpacing: 8,
          ),
          delegate: SliverChildBuilderDelegate(
            (context, index) {
              final item = items[index];
              return Card(
                child: Container(
                  height: item.height,  // Variable height
                  padding: EdgeInsets.all(16),
                  child: Column(
                    crossAxisAlignment: CrossAxisAlignment.start,
                    children: [
                      Text(
                        item.title,
                        style: TextStyle(fontWeight: FontWeight.bold),
                      ),
                      SizedBox(height: 8),
                      Expanded(
                        child: Text(item.content),
                      ),
                    ],
                  ),
                ),
              );
            },
            childCount: items.length,
          ),
        ),
      ],
    );
  }
}
```

### 2. **Responsive Grid Layout**

```dart
class ResponsiveGrid extends StatelessWidget {
  final List<GridItem> items;

  const ResponsiveGrid({required this.items});

  @override
  Widget build(BuildContext context) {
    return LayoutBuilder(
      builder: (context, constraints) {
        int crossAxisCount;
        double childAspectRatio;

        if (constraints.maxWidth > 1200) {
          // Desktop
          crossAxisCount = 5;
          childAspectRatio = 1.0;
        } else if (constraints.maxWidth > 800) {
          // Tablet landscape
          crossAxisCount = 4;
          childAspectRatio = 1.0;
        } else if (constraints.maxWidth > 600) {
          // Tablet portrait
          crossAxisCount = 3;
          childAspectRatio = 1.0;
        } else if (constraints.maxWidth > 400) {
          // Phone landscape
          crossAxisCount = 3;
          childAspectRatio = 0.8;
        } else {
          // Phone portrait
          crossAxisCount = 2;
          childAspectRatio = 0.8;
        }

        return GridView.builder(
          padding: EdgeInsets.all(16),
          gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
            crossAxisCount: crossAxisCount,
            crossAxisSpacing: 16,
            mainAxisSpacing: 16,
            childAspectRatio: childAspectRatio,
          ),
          itemCount: items.length,
          itemBuilder: (context, index) {
            return Card(
              child: Center(
                child: Text('Item ${index + 1}'),
              ),
            );
          },
        );
      },
    );
  }
}
```

### 3. **Infinite Scroll Grid**

```dart
class InfiniteScrollGrid extends StatefulWidget {
  @override
  _InfiniteScrollGridState createState() => _InfiniteScrollGridState();
}

class _InfiniteScrollGridState extends State<InfiniteScrollGrid> {
  List<GridItem> items = [];
  bool isLoading = false;
  bool hasMore = true;
  int currentPage = 1;
  final ScrollController _scrollController = ScrollController();

  @override
  void initState() {
    super.initState();
    _loadItems();
    _scrollController.addListener(_onScroll);
  }

  void _onScroll() {
    if (_scrollController.position.pixels == 
        _scrollController.position.maxScrollExtent) {
      _loadItems();
    }
  }

  Future<void> _loadItems() async {
    if (isLoading || !hasMore) return;

    setState(() {
      isLoading = true;
    });

    try {
      final newItems = await ApiService.fetchGridItems(page: currentPage);
      
      setState(() {
        items.addAll(newItems);
        currentPage++;
        hasMore = newItems.length == 20; // Assuming 20 items per page
        isLoading = false;
      });
    } catch (error) {
      setState(() {
        isLoading = false;
      });
    }
  }

  @override
  Widget build(BuildContext context) {
    return RefreshIndicator(
      onRefresh: () async {
        setState(() {
          items.clear();
          currentPage = 1;
          hasMore = true;
        });
        await _loadItems();
      },
      child: GridView.builder(
        controller: _scrollController,
        padding: EdgeInsets.all(16),
        gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
          crossAxisCount: 2,
          crossAxisSpacing: 16,
          mainAxisSpacing: 16,
        ),
        itemCount: items.length + (hasMore ? 1 : 0),
        itemBuilder: (context, index) {
          if (index == items.length) {
            // Loading indicator
            return Center(
              child: CircularProgressIndicator(),
            );
          }

          final item = items[index];
          return Card(
            child: Column(
              children: [
                Expanded(
                  child: Image.network(
                    item.imageUrl,
                    fit: BoxFit.cover,
                  ),
                ),
                Padding(
                  padding: EdgeInsets.all(8),
                  child: Text(
                    item.title,
                    maxLines: 1,
                    overflow: TextOverflow.ellipsis,
                  ),
                ),
              ],
            ),
          );
        },
      ),
    );
  }

  @override
  void dispose() {
    _scrollController.dispose();
    super.dispose();
  }
}
```

### 4. **Selectable Grid Items**

```dart
class SelectableGrid extends StatefulWidget {
  final List<SelectableItem> items;

  const SelectableGrid({required this.items});

  @override
  _SelectableGridState createState() => _SelectableGridState();
}

class _SelectableGridState extends State<SelectableGrid> {
  Set<String> selectedItems = Set<String>();
  bool isSelectionMode = false;

  @override
  Widget build(BuildContext context) {
    return Column(
      children: [
        if (isSelectionMode)
          Container(
            padding: EdgeInsets.all(16),
            color: Theme.of(context).primaryColor.withOpacity(0.1),
            child: Row(
              children: [
                Text('${selectedItems.length} selected'),
                Spacer(),
                TextButton(
                  child: Text('Select All'),
                  onPressed: _selectAll,
                ),
                TextButton(
                  child: Text('Clear'),
                  onPressed: _clearSelection,
                ),
                TextButton(
                  child: Text('Cancel'),
                  onPressed: _exitSelectionMode,
                ),
              ],
            ),
          ),
        
        Expanded(
          child: GridView.builder(
            padding: EdgeInsets.all(16),
            gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
              crossAxisCount: 2,
              crossAxisSpacing: 16,
              mainAxisSpacing: 16,
            ),
            itemCount: widget.items.length,
            itemBuilder: (context, index) {
              final item = widget.items[index];
              final isSelected = selectedItems.contains(item.id);

              return GestureDetector(
                onTap: () => _handleItemTap(item),
                onLongPress: () => _handleItemLongPress(item),
                child: Card(
                  elevation: isSelected ? 8 : 2,
                  child: Stack(
                    children: [
                      Column(
                        children: [
                          Expanded(
                            child: Image.network(
                              item.imageUrl,
                              fit: BoxFit.cover,
                            ),
                          ),
                          Padding(
                            padding: EdgeInsets.all(8),
                            child: Text(
                              item.title,
                              maxLines: 1,
                              overflow: TextOverflow.ellipsis,
                            ),
                          ),
                        ],
                      ),
                      
                      // Selection overlay
                      if (isSelected)
                        Container(
                          decoration: BoxDecoration(
                            color: Theme.of(context).primaryColor.withOpacity(0.3),
                            borderRadius: BorderRadius.circular(4),
                          ),
                        ),
                      
                      // Selection indicator
                      if (isSelectionMode)
                        Positioned(
                          top: 8,
                          right: 8,
                          child: Container(
                            decoration: BoxDecoration(
                              color: isSelected 
                                ? Theme.of(context).primaryColor 
                                : Colors.white,
                              shape: BoxShape.circle,
                              border: Border.all(
                                color: Theme.of(context).primaryColor,
                              ),
                            ),
                            padding: EdgeInsets.all(4),
                            child: Icon(
                              Icons.check,
                              color: isSelected ? Colors.white : Colors.transparent,
                              size: 16,
                            ),
                          ),
                        ),
                    ],
                  ),
                ),
              );
            },
          ),
        ),
      ],
    );
  }

  void _handleItemTap(SelectableItem item) {
    if (isSelectionMode) {
      setState(() {
        if (selectedItems.contains(item.id)) {
          selectedItems.remove(item.id);
          if (selectedItems.isEmpty) {
            isSelectionMode = false;
          }
        } else {
          selectedItems.add(item.id);
        }
      });
    } else {
      // Handle normal tap
      _openItem(item);
    }
  }

  void _handleItemLongPress(SelectableItem item) {
    setState(() {
      isSelectionMode = true;
      selectedItems.add(item.id);
    });
  }

  void _selectAll() {
    setState(() {
      selectedItems = widget.items.map((item) => item.id).toSet();
    });
  }

  void _clearSelection() {
    setState(() {
      selectedItems.clear();
      isSelectionMode = false;
    });
  }

  void _exitSelectionMode() {
    setState(() {
      selectedItems.clear();
      isSelectionMode = false;
    });
  }

  void _openItem(SelectableItem item) {
    // Handle item open
  }
}
```

## GridView Performance Optimization

### 1. **Use GridView.builder for Large Datasets**

```dart
// ❌ Poor performance for large lists
GridView.count(
  crossAxisCount: 2,
  children: List.generate(10000, (index) {
    return Container(child: Text('Item $index'));
  }),
)

// ✅ Good performance
GridView.builder(
  gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
    crossAxisCount: 2,
  ),
  itemCount: 10000,
  itemBuilder: (context, index) {
    return Container(child: Text('Item $index'));
  },
)
```

### 2. **Optimize Grid Item Widgets**

```dart
// ✅ Extract grid items for better performance
class GridItemWidget extends StatelessWidget {
  final GridItem item;

  const GridItemWidget({Key? key, required this.item}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Card(
      child: Column(
        children: [
          Expanded(child: Image.network(item.imageUrl)),
          Text(item.title),
        ],
      ),
    );
  }
}
```

### 3. **Use RepaintBoundary for Complex Items**

```dart
GridView.builder(
  itemBuilder: (context, index) {
    return RepaintBoundary(
      child: ComplexGridItem(item: items[index]),
    );
  },
)
```

## Common GridView Pitfalls and Solutions

### 1. **GridView in Column**

```dart
// ❌ This will cause unbounded height error
Column(
  children: [
    Text('Header'),
    GridView.count(
      crossAxisCount: 2,
      children: [/* items */],
    ),
  ],
)

// ✅ Solutions
// Solution 1: Use Expanded
Column(
  children: [
    Text('Header'),
    Expanded(
      child: GridView.count(
        crossAxisCount: 2,
        children: [/* items */],
      ),
    ),
  ],
)

// Solution 2: Use shrinkWrap (use carefully)
Column(
  children: [
    Text('Header'),
    GridView.count(
      shrinkWrap: true,
      physics: NeverScrollableScrollPhysics(),
      crossAxisCount: 2,
      children: [/* items */],
    ),
  ],
)
```

### 2. **Aspect Ratio Issues**

```dart
// ❌ Items might look distorted
GridView.count(
  crossAxisCount: 2,
  children: [
    Container(height: 300, child: Text('Tall content')),
  ],
)

// ✅ Use appropriate aspect ratio
GridView.count(
  crossAxisCount: 2,
  childAspectRatio: 0.75,  // Adjust based on content
  children: [
    Container(child: Text('Content')),
  ],
)
```

## Best Practices for GridView in Material Apps

### 1. **Choose the Right Constructor**

```dart
// ✅ Use GridView.count for fixed columns
GridView.count(crossAxisCount: 2, children: fixedItems)

// ✅ Use GridView.extent for responsive width
GridView.extent(maxCrossAxisExtent: 200, children: items)

// ✅ Use GridView.builder for large/dynamic lists
GridView.builder(itemCount: items.length, itemBuilder: ...)
```

### 2. **Handle Empty States**

```dart
Widget buildGrid() {
  if (items.isEmpty) {
    return Center(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Icon(Icons.grid_view, size: 64, color: Colors.grey),
          SizedBox(height: 16),
          Text('No items to display'),
        ],
      ),
    );
  }

  return GridView.builder(/* grid content */);
}
```

### 3. **Consider Responsive Design**

```dart
Widget responsiveGrid() {
  return LayoutBuilder(
    builder: (context, constraints) {
      final crossAxisCount = constraints.maxWidth > 600 ? 4 : 2;
      return GridView.count(
        crossAxisCount: crossAxisCount,
        children: items,
      );
    },
  );
}
```

GridView is essential for creating organized, visually appealing grid layouts in Flutter Material apps. Understanding its constructors, delegates, and optimization techniques will help you build efficient, responsive grid interfaces that provide excellent user experiences across different screen sizes and device types.